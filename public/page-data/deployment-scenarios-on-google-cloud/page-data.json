{"componentChunkName":"component---src-templates-post-js","path":"/deployment-scenarios-on-google-cloud/","result":{"data":{"markdownRemark":{"html":"<p><a href=\"https://cloud.google.com/vertex-ai?hl=us\">Vertex.ai</a> is a Google Cloud service that enables the user to build, deploy, and scale data pipelines and machine learning models. It includes some services to track and manage model artifacts, performances and metrics.\nGoogle provide a <a href=\"https://cloud.google.com/vertex-ai/docs/start/use-vertex-ai-python-sdk\">Python SDK</a> that permits the user to interact directly with the different services.</p>\n<p>Vertex AI pipeline is a service that allows you to orchestrate different steps of a data pipeline. Each step of the pipeline is an autonomous piece of code that will be executed in its own container. Each of these steps can accept inputs and generate outputs for downstream steps. Altogether the steps define a workflow that can be represented as an directed acyclic graph (DAG) (Figure 1). Here I am going to gather some personal notes and feedbacks related to my own experience with this cloud service and try to provide some personal advises.</p>\n<p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/f4801f88256f9bf9569609d1acbf8b82/29114/Vertexai.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 56.44171779141104%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAByElEQVR42n1S2U4VQRDt/3/hQYOoEEP8Bn0AhUCIH2LEmLmz9b73oapnwBtM7ORMdae2U6dGnN+MuLxf8PmHwbtvE06+PBJ+483XXzi7esSH6z+4uBnw6U7i/a3Ex9sZp98lLu41zu803l6NOLs+4PJBkf0JUZIBakA/LaHxvUXU7Pd7Jkdh5z9orSIFB28WquGRk4cY1ghpM3xsKLXBxopFOVgXsDiF2ZCf3qvWGPSKRfPbYLUWizcwxiHE1OONdRDOB6SUqVhF3ZFihnMJpWTkUhBCgnfbvRD4zjmVGFpj4b2HlLJDKKVwOBx6MJ9cKhWIW8cYYEOmzp4aOChqrv3+Dh6xRBozIecMTRNwrV7QGEN6kCrEzqcCpR2Y+WwVlIsU7CApYXUampgrGlkaDUc6z/Pc853z3Qr+hLAthcdlsRPpyEyjpxFzofEKsajUtFFMQ4x1j0VnxvnTNGIcRwhL4jJLDuAEBhebladgQ0vQmIgNL2zT8K/WfDiXi2pLk5Ceomuj5EvQhtbFb7X1d6llZ1dfGj8X5EUMwwBPujNTcRz0jOOk142OfWylVLuGlvScIFJKGxty8vpfF/8/gHWlf3NZOju2T9fLT5tjaaU1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"Vertexai\" title=\"Vertexai\" src=\"/static/f4801f88256f9bf9569609d1acbf8b82/a6d36/Vertexai.png\" srcset=\"/static/f4801f88256f9bf9569609d1acbf8b82/222b7/Vertexai.png 163w,\n/static/f4801f88256f9bf9569609d1acbf8b82/ff46a/Vertexai.png 325w,\n/static/f4801f88256f9bf9569609d1acbf8b82/a6d36/Vertexai.png 650w,\n/static/f4801f88256f9bf9569609d1acbf8b82/e548f/Vertexai.png 975w,\n/static/f4801f88256f9bf9569609d1acbf8b82/3c492/Vertexai.png 1300w,\n/static/f4801f88256f9bf9569609d1acbf8b82/29114/Vertexai.png 1920w\" sizes=\"(max-width: 650px) 100vw, 650px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span></p>\n<p><em>Figure 1</em> : Example of a vertex ai pipeline</p>\n<h2 id=\"anatomy-of-a-component\" style=\"position:relative;\"><a href=\"#anatomy-of-a-component\" aria-label=\"anatomy of a component permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Anatomy of a component</h2>\n<p>The core unit of computation is called a component. A component is an independent piece of code that will be uploaded and containarized in the Vertex platform to be executed. With Vertex, you can use the <a href=\"https://www.kubeflow.org/docs/components/pipelines/v2/\">Kubeflow pipelines sdk</a> to implement your code. A typical components can be implemented as followed.</p>\n<pre class=\"grvsc-container panda-syntax\" data-language=\"python\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">from</span><span class=\"mtk1\"> kfp.v2.dsl </span><span class=\"mtk3\">import</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    Dataset,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    Input,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">@component</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">packages_to_install</span><span class=\"mtk1\">=[</span><span class=\"mtk7\">&quot;put&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">&quot;here&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">&quot;librairies&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">&quot;to&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">&quot;install&quot;</span><span class=\"mtk1\">],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">base_image</span><span class=\"mtk1\">=</span><span class=\"mtk7\">&quot;the docker image to use&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">output_component_file</span><span class=\"mtk1\">=</span><span class=\"mtk7\">&quot;predict.yaml&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">def</span><span class=\"mtk1\"> </span><span class=\"mtk8\">component_one</span><span class=\"mtk1\">(</span><span class=\"mtk9\">processed_data</span><span class=\"mtk1\">: Output[Dataset]):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># ---- imports</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># Import your modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># ---- Helpers</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># Implemenent helpers functions</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># ---- variable</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># add any local variable</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># ---- Component execution</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># Implement the logic of your component</span></span></span></code></pre>\n<p>As you can see, a component is simply a function encapsulated in a <code>@component</code> decorator. The decorator is using three arguments here:</p>\n<ul>\n<li><code>packages_to_install</code>: a <code>list</code> containing the name of the libraries you wish to install and that will be use in you component.</li>\n<li><code>base_image</code>: a docker image with the basic environment you wish to execute your code on.</li>\n<li><code>output_component_file</code>: path where you want the library to generate a <code>yaml</code> template of your component that will be interpreted by vertex to execute your task. An example is showed in the supplemental data of this article.</li>\n</ul>\n<h2 id=\"the-art-of-writing-component\" style=\"position:relative;\"><a href=\"#the-art-of-writing-component\" aria-label=\"the art of writing component permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The art of writing component</h2>\n<p>Being an independent piece of code comes with an important trade-off. <strong>Every extra code you need, has to be implemented in the component function</strong>. Your <code>import</code> statements must be declared here and any helper functions should be implemented as inner functions if you wish to use them. Any code outside the component will be simply ignored.</p>\n<p>At the beginning my components were just huge chunks of code and this was bad. Indeed, inner functions cannot be unit tested which make the maintenance of such code very difficult. To avoid that and after having implemented working components, I refactored the code such that all helpers functions were packaged in our internal library deployed in our private repository. As such these functions can be all unit tested and we can use them by pointing the <code>base_image</code> to a docker image that contains our library. Doing this dramatically reduced the size of our components and make them easy to read and maintain.</p>\n<p>Organising your code may helped to. Here the repository structure:</p>\n<pre class=\"grvsc-container panda-syntax\" data-language=\"bash\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">├── ai_vertex</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">│   ├── components</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">│   ├── __init__.py</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">│   ├── pipelines.py</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">│   ├── image1.Dockerfile</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">│   ├── image2.Dockerfile</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">│   ├── templates</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">│   └── cli.py</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span></code></pre>\n<p>Components are stored in a <code>components</code> folder and are grouped by task (etl, ml or viz). The <code>pipelines.py</code> is where the DAGs are defined. The <code>templates</code> folder is where the templates will be generated and loaded from by the library to deploy and execute your components. I like to encaspulated my users logic into command line applications (CLI). I use <a href=\"https://typer.tiangolo.com/\">Typer</a>, a library that capitalises on <a href=\"https://click.palletsprojects.com/en/8.1.x/\">click</a> but brings the programming philosophy and simplicity of <a href=\"https://fastapi.tiangolo.com/\">FastAPI</a>. I like to use CLI, because it make the developer experience easier and allow me to encapsulated complex tasks into simple-to-use command lines. In my case, the cli contains all the command needed to deploy the pipelines for model training, model evaluation and metrics reports.</p>\n<h2 id=\"making-components-communicate\" style=\"position:relative;\"><a href=\"#making-components-communicate\" aria-label=\"making components communicate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Making components communicate</h2>\n<p>Let's update our previous code.</p>\n<pre class=\"grvsc-container panda-syntax\" data-language=\"python\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">from</span><span class=\"mtk1\"> kfp.v2.dsl </span><span class=\"mtk3\">import</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    Dataset,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    Input,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">@component</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">packages_to_install</span><span class=\"mtk1\">=[</span><span class=\"mtk7\">&quot;put&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">&quot;here&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">&quot;librairies&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">&quot;to&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">&quot;install&quot;</span><span class=\"mtk1\">],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">base_image</span><span class=\"mtk1\">=</span><span class=\"mtk7\">&quot;the docker image to use&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">output_component_file</span><span class=\"mtk1\">=</span><span class=\"mtk7\">&quot;predict.yaml&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">def</span><span class=\"mtk1\"> </span><span class=\"mtk8\">component_one</span><span class=\"mtk1\">(</span><span class=\"mtk9\">raw_data</span><span class=\"mtk1\">: </span><span class=\"mtk10\">str</span><span class=\"mtk1\">, </span><span class=\"mtk9\">processed_data</span><span class=\"mtk1\">: Output[Dataset]):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># ---- imports</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># Import your modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># No helpers because we refactored :-)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># ---- Component execution</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># Implement the logic of your component</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">def</span><span class=\"mtk1\"> </span><span class=\"mtk8\">component_two</span><span class=\"mtk1\">(</span><span class=\"mtk9\">processed_data</span><span class=\"mtk1\">: Input[Dataset], </span><span class=\"mtk9\">metrics</span><span class=\"mtk1\">: Output[Dataset]):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># ---- imports</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># Import your modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># No helpers because we refactored :-)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># ---- Component execution</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># Implement the logic of your component</span></span></span></code></pre>\n<p>Let's understand how a component can generate outputs / artifacts and how these can be digested in downstream steps. Let's imagine the <code>component_one</code> to be a classical processing function that takes raw data, processes it and returns an output ready to be processed by the next step. The <code>raw_data</code> argument is a string that is a path pointing to the source data, a <code>csv</code> file seated in our bucket for example. For I/O operations, you have two choices in Vertex:</p>\n<ul>\n<li>You can use the classical python <a href=\"https://cloud.google.com/python/docs/reference/storage/latest\">library</a> to interact with this file on Cloud storage</li>\n<li>You can leverage the power of Cloud storage FUSE. Briefly, FUSE is an abstraction layer on top of Cloud storage that makes python beleive, it is a simple filesystem. As such you can use classic python code to make I/O operations, and this is super convenient. Let's say you need to save a dataframe as a <code>csv</code> file. Lets see the difference between the two:</li>\n</ul>\n<pre class=\"grvsc-container panda-syntax\" data-language=\"python\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4 mtki\"># WITH THE LIBRARY</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">def</span><span class=\"mtk1\"> </span><span class=\"mtk8\">component_one</span><span class=\"mtk1\">(</span><span class=\"mtk9\">raw_data</span><span class=\"mtk1\">: </span><span class=\"mtk10\">str</span><span class=\"mtk1\">, </span><span class=\"mtk9\">processed_data</span><span class=\"mtk1\">: Output[Dataset]):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">import</span><span class=\"mtk1\"> pandas </span><span class=\"mtk3\">as</span><span class=\"mtk1\"> pd</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">from</span><span class=\"mtk1\"> google.cloud.storage </span><span class=\"mtk3\">import</span><span class=\"mtk1\"> Client, Bucket</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    gcs_client = Client()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    bucket: Bucket = gcs_client.bucket(bucket_name)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    blob = bucket.get_blob(raw_data)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># Read data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    my_dataframe = pd.read_csv(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        io.StringIO(blob.download_as_bytes().decode(encoding)),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># save the dataframe as csv</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    bucket.blob(processed_data.path).upload_from_string(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        my_dataframe.to_csv(), </span><span class=\"mtk9\">content_type</span><span class=\"mtk1\">=</span><span class=\"mtk7\">&quot;text/csv&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4 mtki\"># WITH FUSE</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">def</span><span class=\"mtk1\"> </span><span class=\"mtk8\">component_one</span><span class=\"mtk1\">(</span><span class=\"mtk9\">raw_data</span><span class=\"mtk1\">: </span><span class=\"mtk10\">str</span><span class=\"mtk1\">, </span><span class=\"mtk9\">processed_data</span><span class=\"mtk1\">: Output[Dataset]):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    my_dataframe = pd.read_csv(</span><span class=\"mtk7\">&quot;path_to_data&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    my_dataframe.to_csv(</span><span class=\"mtk7\">&quot;path_destination&quot;</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<blockquote>\n<p>From a developer persepctive using FUSE is really neat.</p>\n</blockquote>\n<p>Notice the type of <code>processed_data</code>. It is an <code>Output</code> of type <code>Dataset</code>. <code>Dataset</code> inherits from the <code>Artifact</code> class in the python sdk. It means that outputs are treated as artifacts (files, models, markdown, images). You can read <a href=\"https://www.kubeflow.org/docs/components/pipelines/v2/data-types/artifacts/\">here</a> and <a href=\"https://kubeflow-pipelines.readthedocs.io/en/latest/source/dsl.html#kfp.dsl.Artifact\">here</a> for more details. An artifact holds the representation of an <code>Input</code> or <code>Output</code> object. It contains some interesting properties that allow the developer to manipulate it and extract its path (simple, use the <code>path</code> property as shown in the code example).</p>\n<p>Let's implement the second component.</p>\n<pre class=\"grvsc-container panda-syntax\" data-language=\"python\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">def</span><span class=\"mtk1\"> </span><span class=\"mtk8\">component_two</span><span class=\"mtk1\">(</span><span class=\"mtk9\">processed_data</span><span class=\"mtk1\">: Input[Dataset], </span><span class=\"mtk9\">metrics</span><span class=\"mtk1\">: Output[Dataset]):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">import</span><span class=\"mtk1\"> pandas </span><span class=\"mtk3\">as</span><span class=\"mtk1\"> pd</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    data = pd.read_csv(processed_data.path)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4 mtki\"># run your model !! Fake code !!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    model.fit()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    y_pred = model.predict(X_test)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    metrics_df = compute_metrics(y_train, y_pred_from_train)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    metrics_df.to_csv(metrics.path)</span></span></span></code></pre>\n<p>Now that we have our components we need to stick them together in a pipeline.</p>\n<h2 id=\"a-pipeline-to-rule-them-all\" style=\"position:relative;\"><a href=\"#a-pipeline-to-rule-them-all\" aria-label=\"a pipeline to rule them all permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A pipeline to rule them all</h2>\n<p>Here the anatomy of our pipeline:</p>\n<pre class=\"grvsc-container panda-syntax\" data-language=\"python\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">from</span><span class=\"mtk1\"> kfp.v2.dsl </span><span class=\"mtk3\">import</span><span class=\"mtk1\"> pipeline</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">@pipeline</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">pipeline_root</span><span class=\"mtk1\">=</span><span class=\"mtk5\">PIPELINE_ROOT</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">name</span><span class=\"mtk1\">=</span><span class=\"mtk7\">&quot;eval-prod-sleep-stage-pipeline&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">def</span><span class=\"mtk1\"> </span><span class=\"mtk8\">super_pipeline</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">raw_data_path</span><span class=\"mtk1\">: </span><span class=\"mtk10\">str</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    process_data_task = component_one(</span><span class=\"mtk9\">raw_data</span><span class=\"mtk1\">=raw_data_path)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    train_model_task = component_two(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">processed_data</span><span class=\"mtk1\">=component_one.outputs[</span><span class=\"mtk7\">&quot;processed_data&quot;</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span></code></pre>\n<blockquote>\n<p>The <code>pipeline_root</code> is the location where the pipeline will save runs and their respective artifacts in your cloud environment (buckets).</p>\n</blockquote>\n<p>The magic resides in the possibily of querying the outputs of the previous task simply using the property <code>outputs</code> and the function argument name of type <code>Output[Dataset]</code>. This approach is valid for any outputs that needs to be ingested by another step.</p>\n<p>Note that here, if one of your task is resource intensive, you can actually specify your needs. Let's imagine that our training needs a lot of memory and cpus.</p>\n<pre class=\"grvsc-container panda-syntax\" data-language=\"python\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">from</span><span class=\"mtk1\"> kfp.v2.dsl </span><span class=\"mtk3\">import</span><span class=\"mtk1\"> pipeline</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk8\">@pipeline</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">pipeline_root</span><span class=\"mtk1\">=</span><span class=\"mtk5\">PIPELINE_ROOT</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">name</span><span class=\"mtk1\">=</span><span class=\"mtk7\">&quot;eval-prod-sleep-stage-pipeline&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">def</span><span class=\"mtk1\"> </span><span class=\"mtk8\">super_pipeline</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">raw_data_path</span><span class=\"mtk1\">: </span><span class=\"mtk10\">str</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    process_data_task = component_one(</span><span class=\"mtk9\">raw_data</span><span class=\"mtk1\">=raw_data_path)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    train_model_task = component_two(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">processed_data</span><span class=\"mtk1\">=component_one.outputs[</span><span class=\"mtk7\">&quot;processed_data&quot;</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ).set_cpu_limit(</span><span class=\"mtk7\">&quot;32&quot;</span><span class=\"mtk1\">).set_memory_limit(</span><span class=\"mtk7\">&quot;128G&quot;</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p>Using the functions <code>set_cpu_limit()</code> and <code>set_memory_limit()</code> allows to do that very easily. Becareful to know the compatible configurations in your Google cloud environment.</p>\n<h2 id=\"execute-the-pipeline\" style=\"position:relative;\"><a href=\"#execute-the-pipeline\" aria-label=\"execute the pipeline permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Execute the pipeline</h2>\n<p>To execute the pipeline we use the <a href=\"https://cloud.google.com/python/docs/reference/aiplatform/latest/google.cloud.aiplatform\">aiplatform</a> python package. It is pretty simple to implement</p>\n<pre class=\"grvsc-container panda-syntax\" data-language=\"python\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">from</span><span class=\"mtk1\"> google.cloud </span><span class=\"mtk3\">import</span><span class=\"mtk1\"> aiplatform</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">from</span><span class=\"mtk1\"> kfp.v2 </span><span class=\"mtk3\">import</span><span class=\"mtk1\"> compiler</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">def</span><span class=\"mtk1\"> </span><span class=\"mtk8\">init_pipeline</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">pipeline_function</span><span class=\"mtk1\">: Callable,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">params</span><span class=\"mtk1\">: dict[</span><span class=\"mtk10\">str</span><span class=\"mtk1\">, Any],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">template_path</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    compiler.Compiler().compile(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">pipeline_func</span><span class=\"mtk1\">=pipeline_function,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">pipeline_parameters</span><span class=\"mtk1\">=params,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">package_path</span><span class=\"mtk1\">=template_path,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    aiplatform.init(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">project</span><span class=\"mtk1\">=project,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">staging_bucket</span><span class=\"mtk1\">=params[</span><span class=\"mtk7\">&quot;staging_bucket&quot;</span><span class=\"mtk1\">],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">experiment</span><span class=\"mtk1\">=params[</span><span class=\"mtk7\">&quot;experiment_name&quot;</span><span class=\"mtk1\">],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">location</span><span class=\"mtk1\">=location,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">return</span><span class=\"mtk1\"> aiplatform.PipelineJob(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">display_name</span><span class=\"mtk1\">=params[</span><span class=\"mtk7\">&quot;experiment_name&quot;</span><span class=\"mtk1\">],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">template_path</span><span class=\"mtk1\">=template_path,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">job_id</span><span class=\"mtk1\">=</span><span class=\"mtk5\">f</span><span class=\"mtk7\">&#39;</span><span class=\"mtk5\">{</span><span class=\"mtk1\">prefix</span><span class=\"mtk5\">}</span><span class=\"mtk7\">-</span><span class=\"mtk5\">{</span><span class=\"mtk1\">params[</span><span class=\"mtk7\">&quot;experiment_name&quot;</span><span class=\"mtk1\">]</span><span class=\"mtk5\">}</span><span class=\"mtk7\">-</span><span class=\"mtk5\">{</span><span class=\"mtk1\">params[</span><span class=\"mtk7\">&quot;experiment_run&quot;</span><span class=\"mtk1\">]</span><span class=\"mtk5\">}</span><span class=\"mtk7\">-</span><span class=\"mtk5\">{TIMESTAMP}</span><span class=\"mtk7\">&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">enable_caching</span><span class=\"mtk1\">=</span><span class=\"mtk5\">False</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">run = init_pipeline(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">pipeline_function</span><span class=\"mtk1\">=super_pipeline,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">params</span><span class=\"mtk1\">=params,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">template_path</span><span class=\"mtk1\">=</span><span class=\"mtk7\">&quot;templates/super-pipeline.json&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">project</span><span class=\"mtk1\">=gcp_project,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">location</span><span class=\"mtk1\">=gcp_location,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">run.submit()</span></span></span></code></pre>\n<h2 id=\"supplemental-data\" style=\"position:relative;\"><a href=\"#supplemental-data\" aria-label=\"supplemental data permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Supplemental data</h2>\n<pre class=\"grvsc-container panda-syntax\" data-language=\"yaml\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4 mtki\"># PIPELINE DEFINITION</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4 mtki\"># Name: name_of_pipeline</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4 mtki\"># Inputs:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4 mtki\">#    my_input: str</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4 mtki\"># Outputs:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4 mtki\">#    my_output: system.Dataset</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">components</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">comp-name_of_pipeline</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">executorLabel</span><span class=\"mtk1\">: </span><span class=\"mtk7\">name_of_pipeline</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">inputDefinitions</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">parameters</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">my_input</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk10\">parameterType</span><span class=\"mtk1\">: </span><span class=\"mtk7\">STRING</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">outputDefinitions</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">artifacts</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">my_outputs</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk10\">artifactType</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">schemaTitle</span><span class=\"mtk1\">: </span><span class=\"mtk7\">system.Dataset</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">schemaVersion</span><span class=\"mtk1\">: </span><span class=\"mtk5\">0.0.1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">deploymentSpec</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">executors</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">exec-name_of_pipeline</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">container</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">args</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        - </span><span class=\"mtk7\">--executor_input</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        - </span><span class=\"mtk7\">&#39;{{$}}&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        - </span><span class=\"mtk7\">--function_to_execute</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        - </span><span class=\"mtk7\">name_of_pipeline</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">command</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        - </span><span class=\"mtk7\">sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        - </span><span class=\"mtk7\">-c</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        - </span><span class=\"mtk7\">&quot;</span><span class=\"mtk6\">\\n</span><span class=\"mtk7\">if ! [ -x </span><span class=\"mtk6\">\\&quot;</span><span class=\"mtk7\">$(command -v pip)</span><span class=\"mtk6\">\\&quot;</span><span class=\"mtk7\"> ]; then</span><span class=\"mtk6\">\\n</span><span class=\"mtk7\">    python3 -m ensurepip ||</span><span class=\"mtk6\">\\</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">          </span><span class=\"mtk6\">\\ </span><span class=\"mtk7\">python3 -m ensurepip --user || apt-get install python3-pip</span><span class=\"mtk6\">\\n</span><span class=\"mtk7\">fi</span><span class=\"mtk6\">\\n\\n</span><span class=\"mtk7\">PIP_DISABLE_PIP_VERSION_CHECK=1</span><span class=\"mtk6\">\\</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">          </span><span class=\"mtk6\">\\ </span><span class=\"mtk7\">python3 -m pip install --quiet     --no-warn-script-location &#39;pandas&#39;</span><span class=\"mtk6\">\\</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">          </span><span class=\"mtk6\">\\ </span><span class=\"mtk7\">&#39;kfp==2.0.1&#39; &amp;&amp; </span><span class=\"mtk6\">\\&quot;</span><span class=\"mtk7\">$0</span><span class=\"mtk6\">\\&quot;</span><span class=\"mtk7\"> </span><span class=\"mtk6\">\\&quot;</span><span class=\"mtk7\">$@</span><span class=\"mtk6\">\\&quot;\\n</span><span class=\"mtk7\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        - </span><span class=\"mtk7\">sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        - </span><span class=\"mtk7\">-ec</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        - </span><span class=\"mtk7\">&#39;program_path=$(mktemp -d)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">          printf &quot;%s&quot; &quot;$0&quot; &gt; &quot;$program_path/ephemeral_component.py&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">          python3 -m kfp.components.executor_main --component_module_path &quot;$program_path/ephemeral_component.py&quot; &quot;$@&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">          &#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        - </span><span class=\"mtk7\">&quot;components code is here&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">image</span><span class=\"mtk1\">: </span><span class=\"mtk7\">eu.gcr.io/sensav2/suntraining/sunpy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">pipelineInfo</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">name</span><span class=\"mtk1\">: </span><span class=\"mtk7\">name_of_pipeline</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">root</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">dag</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">outputs</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">artifacts</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">my_outputs</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk10\">artifactSelectors</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          - </span><span class=\"mtk10\">outputArtifactKey</span><span class=\"mtk1\">: </span><span class=\"mtk7\">name_of_pipeline</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">producerSubtask</span><span class=\"mtk1\">: </span><span class=\"mtk7\">name_of_pipeline</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">tasks</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">name_of_pipeline</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">cachingOptions</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk10\">enableCache</span><span class=\"mtk1\">: </span><span class=\"mtk5\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">componentRef</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk10\">name</span><span class=\"mtk1\">: </span><span class=\"mtk7\">comp-name_of_pipeline</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">inputs</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk10\">parameters</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk10\">my_input</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk10\">componentInputParameter</span><span class=\"mtk1\">: </span><span class=\"mtk7\">my_input</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">taskInfo</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk10\">name</span><span class=\"mtk1\">: </span><span class=\"mtk7\">name_of_pipeline</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">inputDefinitions</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">parameters</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">my_input</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">parameterType</span><span class=\"mtk1\">: </span><span class=\"mtk7\">STRING</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk10\">outputDefinitions</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10\">artifacts</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk10\">my_outputs</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk10\">artifactType</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk10\">schemaTitle</span><span class=\"mtk1\">: </span><span class=\"mtk7\">system.Dataset</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk10\">schemaVersion</span><span class=\"mtk1\">: </span><span class=\"mtk5\">0.0.1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">schemaVersion</span><span class=\"mtk1\">: </span><span class=\"mtk5\">2.1.0</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk10\">sdkVersion</span><span class=\"mtk1\">: </span><span class=\"mtk7\">kfp-2.0.1</span></span></span></code></pre>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .panda-syntax {\n    background-color: #292A2B;\n    color: #E6E6E6;\n  }\n  .panda-syntax .mtki { font-style: italic; }\n  .panda-syntax .mtk3 { color: #FF75B5; }\n  .panda-syntax .mtk1 { color: #E6E6E6; }\n  .panda-syntax .mtk8 { color: #6FC1FF; }\n  .panda-syntax .mtk9 { color: #BBBBBB; }\n  .panda-syntax .mtk7 { color: #19F9D8; }\n  .panda-syntax .mtk5 { color: #FFB86C; }\n  .panda-syntax .mtk4 { color: #676B79; }\n  .panda-syntax .mtk10 { color: #FFCC95; }\n  .panda-syntax .mtk6 { color: #45A9F9; }\n  .panda-syntax .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"Vertex.ai and Kubeflow SDK","date":"06 January, 2023","tags":["Python","Google"]},"excerpt":"Vertex.ai is a Google Cloud service that enables the user to build, deploy, and scale data pipelines and machine learning models. It…"}},"pageContext":{"slug":"/deployment-scenarios-on-google-cloud/"}},"staticQueryHashes":["3649515864","63159454"],"slicesMap":{}}